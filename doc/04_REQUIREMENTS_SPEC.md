# 要求仕様書 - VanishToDo

## 1. はじめに

### 1.1 文書の目的
本文書は、VanishToDoプロジェクトの要求仕様を定義し、開発者（大河るり）が実装すべき機能要件と非機能要件を明確化することを目的とする。

### 1.2 対象読者
- プロジェクトオーナー兼開発者：大河るり
- 将来的な保守・拡張時の参照用

### 1.3 文書の範囲
本文書は、VanishToDoの初期リリース（v1.0）における要求事項を記載する。将来的な拡張機能については本文書の範囲外とする。

### 1.4 用語定義

| 用語 | 定義 |
|------|------|
| タスク | ユーザーが実行すべき作業項目、未完了 |
| 完了タスク | ユーザーが実行した作業項目 |
| 重さ | タスクの推定所要時間による分類（重・中・軽） |
| 重タスク | 1時間以上かかると推定されるタスク |
| 中タスク | 15分～1時間で完了すると推定されるタスク |
| 軽タスク | 15分以内で完了すると推定されるタスク |
| 締切タスク | 期限が設定されたタスク（重さなし） |
| 表示制限 | 各カテゴリで表示するタスク数の上限 |
| Vanish（消失） | 古いタスクを自動的に非表示にする機能 |
| LLM | Large Language Model（大規模言語モデル） |

## 2. 全体要求

### 2.1 製品の位置づけ
VanishToDoは、タスク管理の継続利用を実現するWebアプリケーションである。「入力の簡素化」と「表示の最適化」により、従来のToDoアプリが抱える「使い続けられない」という問題を解決する。

### 2.2 主要機能概要

1. **スマートタスク入力**
   - LLMによる自動補完
   - 自然言語処理による解釈
   - タスクの自動分割

2. **制限付き表示システム**
   - 各カテゴリ3個までの表示制限
   - 2週間経過後の自動非表示
   - 重さ別フィルタリング

3. **タスク管理**
   - タスクの作成・編集・削除
   - 重さの設定（重・中・軽）
   - 締切の設定

### 2.3 利用者
- プライマリーユーザー：大河るり（開発者本人）
- シングルユーザー専用（マルチユーザー非対応）

### 2.4 利用環境
- デバイス：PC、スマートフォン、タブレット
- ブラウザ：Google Chrome（最新版）
- ネットワーク：インターネット接続必須

## 3. 機能要求

### 3.1 タスク入力機能

#### FR-1.1 基本入力機能

| 項目 | 内容 |
|------|------|
| 機能ID | FR-1.1 |
| 機能名 | 基本タスク入力 |
| 説明 | ユーザーがタスクを素早く入力できる |
| 入力 | タスク内容（テキスト、最大500文字） |
| 処理 | 1. 入力内容の検証<br>2. タスクオブジェクトの生成<br>3. データベースへの保存 |
| 出力 | 作成されたタスクの表示 |
| 前提条件 | ユーザーが認証済み |
| 事後条件 | タスクがデータベースに保存される |
| 優先度 | 必須 |

#### FR-1.2 LLM自動補完

| 項目 | 内容 |
|------|------|
| 機能ID | FR-1.2 |
| 機能名 | スマート補完 |
| 説明 | 曖昧な入力をLLMが解釈し、適切なタスクに変換 |
| 入力 | 曖昧なテキスト（例：「メール」） |
| 処理 | 1. Cloudflare Workers AIへのリクエスト<br>2. 補完案の生成<br>3. ユーザーへの提示 |
| 出力 | 補完されたタスク文（例：「メールを確認する」） |
| 使用モデル | Llama 3.2 1B Instruct または同等モデル |
| API制限 | 無料枠内（1日あたり10,000ニューロン） |
| 前提条件 | Workers AI APIが利用可能 |
| 事後条件 | 補完案が表示される |
| 優先度 | 高 |

#### FR-1.3 タスク自動分割

| 項目 | 内容 |
|------|------|
| 機能ID | FR-1.3 |
| 機能名 | メモからタスク分割 |
| 説明 | 長文メモを複数のアクショナブルなタスクに分割 |
| 入力 | 複数行のテキスト（最大2000文字） |
| 処理 | 1. LLMによる内容分析<br>2. タスク候補の生成<br>3. 各タスクの重さ推定 |
| 出力 | 分割されたタスクリスト（プレビュー） |
| 前提条件 | 分割ボタンが押される |
| 事後条件 | ユーザーが選択したタスクが保存される |
| 優先度 | 中 |

#### FR-1.4 重さ自動判定

| 項目 | 内容 |
|------|------|
| 機能ID | FR-1.4 |
| 機能名 | タスク重さ自動判定 |
| 説明 | タスク内容から推定所要時間を判定 |
| 入力 | タスクテキスト |
| 処理 | 1. LLMによる内容解析<br>2. 推定時間の計算<br>3. 重さカテゴリの判定 |
| 出力 | 重さ（重/中/軽）の設定 |
| 判定基準 | - 重：1時間以上<br>- 中：15分～1時間<br>- 軽：15分以内 |
| 前提条件 | タスクが入力される |
| 事後条件 | タスクに重さが設定される |
| 優先度 | 高 |

### 3.2 タスク表示機能

#### FR-2.1 制限付き表示

| 項目 | 内容 |
|------|------|
| 機能ID | FR-2.1 |
| 機能名 | 表示数制限 |
| 説明 | 各重さカテゴリで最新3個のタスクのみ表示 |
| 表示ルール | - 各カテゴリ（重/中/軽）：最新3個<br>- 締切タスク：全て表示<br>- 2週間以上前のタスク：非表示 |
| ソート順 | 作成日時の降順（新しい順） |
| 前提条件 | タスクが存在する |
| 事後条件 | 制限された数のタスクが表示される |
| 優先度 | 必須 |

#### FR-2.2 重さ別フィルタリング

| 項目 | 内容 |
|------|------|
| 機能ID | FR-2.2 |
| 機能名 | カテゴリフィルタ |
| 説明 | タスクを重さでフィルタリング表示 |
| フィルタオプション | - すべて<br>- 重<br>- 中<br>- 軽<br>- 締切 |
| UI | 画面下部のタブ形式ボタン |
| 前提条件 | メイン画面・全タスク表示画面が表示されている |
| 事後条件 | 選択したカテゴリのタスクのみ表示 |
| 優先度 | 必須 |

#### FR-2.3 自動非表示（Vanish）

| 項目 | 内容 |
|------|------|
| 機能ID | FR-2.3 |
| 機能名 | 古いタスクの自動非表示 |
| 説明 | 作成から2週間経過したタスクを自動的に非表示 |
| 非表示条件 | - 作成日時から14日経過<br>- 締切なし<br>- 未完了 |
| 例外 | 締切ありタスクは対象外 |
| 前提条件 | タスクが存在する |
| 事後条件 | 条件を満たすタスクが非表示になる |
| 優先度 | 必須 |

#### FR-2.4 全タスク表示

| 項目 | 内容 |
|------|------|
| 機能ID | FR-2.4 |
| 機能名 | 全タスク表示 |
| 説明 | 制限なしで全タスクを表示・管理 |
| アクセス方法 | メニュー操作 |
| 前提条件 | メニューで全タスク表示を選択 |
| 事後条件 | 全タスク画面が表示される |
| 優先度 | 中 |

#### FR-2.5 完了タスク表示

| 項目 | 内容 |
|------|------|
| 機能ID | FR-2.5 |
| 機能名 | 完了タスク表示 |
| 説明 | 全完了タスクを表示・管理 |
| アクセス方法 | メニュー操作 |
| 前提条件 | メニューで完了タスク表示を選択 |
| 事後条件 | 完了タスク画面が表示される |
| 優先度 | 中 |

### 3.3 タスク管理機能

#### FR-3.1 タスク編集

| 項目 | 内容 |
|------|------|
| 機能ID | FR-3.1 |
| 機能名 | タスク編集 |
| 説明 | 既存タスクの内容を変更 |
| 編集可能項目 | - タスク名<br>- 重さ<br>- 締切日 |
| UI | インライン編集（モーダルなし） |
| 保存 | 自動保存（フォーカスアウト時・アプリ終了時） |
| 前提条件 | タスクが存在する |
| 事後条件 | 変更内容がDBに反映される |
| 優先度 | 必須 |

#### FR-3.2 タスク削除

| 項目 | 内容 |
|------|------|
| 機能ID | FR-3.2 |
| 機能名 | タスク削除 |
| 説明 | 不要なタスクを削除 |
| 削除方法 | - スワイプ（モバイル）<br>- 削除ボタン（PC） |
| 確認 | 削除確認ダイアログ（オプション） |
| Undo | 5秒間の取り消し可能 |
| 前提条件 | タスクが存在する |
| 事後条件 | タスクがDBから削除される |
| 優先度 | 必須 |

#### FR-3.3 タスク完了

| 項目 | 内容 |
|------|------|
| 機能ID | FR-3.3 |
| 機能名 | タスク完了 |
| 説明 | タスクを完了状態にする |
| 操作 | チェックボックスのクリック/タップ |
| フィードバック | - 完了アニメーション<br>- 1秒後にフェードアウト |
| 記録 | 完了日時の記録 |
| 前提条件 | タスクが存在する |
| 事後条件 | タスクが完了状態になる |
| 優先度 | 必須 |

#### FR-3.4 締切設定

| 項目 | 内容 |
|------|------|
| 機能ID | FR-3.4 |
| 機能名 | 締切管理 |
| 説明 | タスクに期限を設定 |
| UI | - カレンダー選択<br>- クイック選択（今日/明日/来週） |
| 表示 | - 締切までの日数表示<br>- 期限切れは赤字強調 |
| 通知 | 締切24時間前に視覚的警告 |
| 前提条件 | タスクが存在する |
| 事後条件 | 締切が設定される |
| 優先度 | 高 |

#### FR-3.5 タスク一括削除

| 項目 | 内容 |
|------|------|
| 機能ID | FR-3.5 |
| 機能名 | タスク一括削除 |
| 説明 | 不要なタスクを一括削除 |
| 削除方法 | - チェックボックスで削除対象選択<br>- 削除実行ボタン押下 |
| 確認 | 削除確認ダイアログ |
| Undo | 5秒間の取り消し可能 |
| 前提条件 | -タスク・完了タスクが存在する |
| 事後条件 | 選択タスク・完了タスクがDBから削除される |
| UI | 全件選択/選択解除ボタンも設ける |
| 優先度 | 中 |

#### FR-3.6 タスク一括復帰

| 項目 | 内容 |
|------|------|
| 機能ID | FR-3.6 |
| 機能名 | タスク一括復帰 |
| 説明 | 完了タスクを一括未完了状態に遷移させる |
| 削除方法 | - チェックボックスで対象選択<br>- 復帰実行ボタン押下 |
| 確認 | 復帰確認ダイアログ（オプション） |
| 前提条件 | -完了タスクが存在する |
| 事後条件 | 選択完了タスクが未完了状態に遷移する |
| UI | 全件選択/選択解除ボタンも設ける |
| 優先度 | 中 |

## FR-3.7: タスクの自動クリーンアップ

### 概要
完了タスクと削除タスクを一定期間後に自動的に物理削除する

### 詳細
- **完了タスク**: 完了から30日経過後に物理削除
- **削除タスク**: 論理削除から7日経過後に物理削除
- **実行タイミング**: 日次バッチ処理（Cloudflare Cron Trigger使用）
- **通知**: なし（サイレントに削除）

### 理由
- データベース容量の節約
- パフォーマンス維持
- 古いタスクは参照価値が低い

### 例外
- なし（すべてのタスクが対象）

### 将来の拡張
- アーカイブ機能（削除前にエクスポート）を検討

### 3.4 特殊機能

#### FR-4.1 日次達成モード

| 項目 | 内容 |
|------|------|
| 機能ID | FR-4.1 |
| 機能名 | 日次ノルマ管理 |
| 説明 | 1日の目標タスク数を設定し、達成後は追加表示しない |
| デフォルト目標 | - 重：1個<br>- 中：2個<br>- 軽：3個 |
| 達成時動作 | - 「今日はお疲れ様」メッセージ<br>- 新規タスク非表示<br>- 「もっとやる」ボタンで解除可 |
| リセット | 日付変更時に自動リセット |
| 前提条件 | 日次達成モードが有効 |
| 事後条件 | 目標達成後の表示制御 |
| 優先度 | 中 |

## 4. 非機能要求

### 4.1 性能要求

#### NFR-1 レスポンス時間

| 項目 | 要求値 | 測定条件 |
|------|--------|----------|
| 初回ページロード | 2秒以内 | 3G回線相当 |
| タスク追加 | 0.5秒以内 | ローカル処理 |
| LLM処理 | 5秒以内 | Workers AI応答含む |
| タスク表示切替 | 0.3秒以内 | フィルタリング |
| DB同期 | 1秒以内 | D1への書き込み |

#### NFR-2 容量・スケール

| 項目 | 要求値 |
|------|--------|
| 最大タスク数 | 1,000件/ユーザー |
| 最大文字数（タスク名） | 500文字 |
| 最大文字数（メモ分割） | 500文字 |
| 同時処理 | シングルユーザーのため考慮不要 |

### 4.2 信頼性要求

#### NFR-3 可用性

| 項目 | 要求値 |
|------|--------|
| サービス稼働率 | 99%以上（Cloudflare SLAに準拠） |
| データ永続性 | D1の自動バックアップに依存 |

#### NFR-4 障害対策

| 項目 | 対策 |
|------|------|
| ネットワーク断 | ローカルストレージで一時保存、復旧後同期 |
| LLM API障害 | 基本機能（手動入力）は継続動作 |
| 認証失敗 | 再認証画面へリダイレクト |

### 4.3 使用性要求

#### NFR-5 操作性

| 項目 | 要求 |
|------|------|
| 学習時間 | 初回利用から5分以内に基本操作習得 |
| エラー率 | 主要タスクの誤操作率5%未満 |
| 入力効率 | タスク入力は10秒以内で完了 |

#### NFR-6 アクセシビリティ

| 項目 | 要求 |
|------|------|
| レスポンシブ対応 | スマホ（320px）〜PC（1920px） |
| タッチ操作 | 44px以上のタップターゲット |
| キーボード操作 | Tab移動、Enterで主要操作可能 |

### 4.4 セキュリティ要求

#### NFR-7 認証・認可

| 項目 | 要求 |
|------|------|
| 認証方式 | Cloudflare Access（メールOTP） |
| OTP形式 | 6桁数字、有効期限10分 |
| セッション | Cloudflare Accessで実施(30日設定) |
| アクセス制御 | シングルユーザーのみ |

#### NFR-8 データ保護

| 項目 | 要求 |
|------|------|
| 通信暗号化 | HTTPS（TLS 1.3） |
| データ暗号化 | D1のデフォルト暗号化 |
| 個人情報 | メールアドレスのみ保持 |

### 4.5 移植性・互換性要求

#### NFR-9 ブラウザ対応

| 項目 | 要求 |
|------|------|
| 対応ブラウザ | Google Chrome最新版 |
| JavaScript | ES2022準拠 |
| CSS | CSS3、CSS Grid、Flexbox使用 |

### 4.6 保守性要求

#### NFR-10 コード品質

| 項目 | 要求 |
|------|------|
| 言語 | TypeScript（型安全性確保） |
| フレームワーク | Hono（軽量、Workers対応） |
| ランタイム | Bun（高速実行） |
| リンター | Biome適用 |

## 5. インターフェース要求

### 5.1 ユーザーインターフェース

#### UI-1 画面構成

| 画面名 | 説明 | 主要要素 |
|--------|------|----------|
| ログイン画面 | メール認証 | メール入力、OTP入力 |
| メイン画面 | タスク一覧と入力 | タスクリスト、入力欄、フィルタ |
| 全タスク画面 | 全タスク管理 | 検索、ソート、一括削除 |
| 完了タスク画面 | 完了タスク管理 | 検索、ソート、一括削除・一括復帰 |

#### UI-2 画面遷移

```
[ログイン画面] → [メイン画面] ⇄ [全タスク画面]
                             ⇄
                       ⇄ [完了タスク画面]
```

### 5.2 外部インターフェース

#### EI-1 Cloudflare Workers AI

| 項目 | 仕様 |
|------|------|
| エンドポイント | Workers AI REST API |
| 認証 | 個別にはなし(Cloudflare Accessで実施済み) |
| モデル | Llama 3.2 1B Instruct |
| レスポンス形式 | JSON |

**参考:** レート制限
  - Workers: 100,000リクエスト/日
  - Workers AI: 10,000ニューロン/日
  - D1: 5GB、500万行書き込み/月
  - KV: 1,000書き込み/日

#### EI-2 Cloudflare D1

| 項目 | 仕様 |
|------|------|
| データベース | SQLite互換 |
| アクセス方法 | Workers Binding |
| バックアップ | 自動（Cloudflare管理） |
| 制限 | 5GB（無料枠） |

#### EI-3 Cloudflare Access

| 項目 | 仕様 |
|------|------|
| 認証方法 | Email OTP |
| 有効期限 | 30日 |

## 10. 追跡可能性

要求仕様とユーザーストーリーの対応表：

| 要求ID | 対応するユーザーストーリー |
|--------|---------------------------|
| FR-1.1 | US-1.1: クイックタスク入力 |
| FR-1.2 | US-1.2: 自然言語でのタスク入力 |
| FR-1.3 | US-1.3: メモからタスク分割 |
| FR-1.4 | US-1.4: タスクの重さ自動判定 |
| FR-2.1 | US-2.1: 制限付きタスク表示 |
| FR-2.2 | US-2.2: 重さ別フィルタリング |
| FR-2.3 | US-2.1: 制限付きタスク表示（Vanish機能） |
| FR-3.1 | US-3.1: タスク編集 |
| FR-3.2 | US-3.2: タスク削除 |
| FR-3.3 | US-2.4: タスク完了フィードバック |
| FR-3.4 | US-3.3: 締切設定 |
| FR-3.5 | US-2.5: 完了タスク表示<br>US-3.4: 全タスク表示 |
| FR-3.6 | US-3.5: 完了タスク表示 |
| FR-4.1 | US-2.3: 日次達成モード |

---

## 付録A: Cloudflare Workers AI使用モデル候補

無料枠で使用可能な主要モデル：

### テキスト生成（タスク補完・分割用）
- **@cf/meta/llama-3.2-1b-instruct** - 推奨（バランスが良い）
- @cf/tinyllama/tinyllama-1.1b-chat-v1.0（軽量）
- @cf/qwen/qwen1.5-0.5b-chat（超軽量）

### 使用ニューロン目安
- タスク補完: 約10ニューロン/リクエスト
- タスク分割: 約30ニューロン/リクエスト
- 重さ判定: 約5ニューロン/リクエスト

1日の想定使用量：
- タスク入力: 20回 × 10 = 200ニューロン
- タスク分割: 2回 × 30 = 60ニューロン
- 重さ判定: 20回 × 5 = 100ニューロン
- **合計: 約360ニューロン/日（無料枠10,000の範囲内）**

---

*本文書は、VanishToDoプロジェクトの要求仕様を定義し、実装の基準となるものである。*
